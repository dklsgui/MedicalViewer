<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifti Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/layui/2.9.14/css/layui.css" integrity="sha512-YL3el60sSycKIM/ld2Vf1bD4qd3JvBJ0+y4Ra/rOdZrin7FC+ng3JSu2yGHddZ6m+npECxE4BCw76sGnH9PyWw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="${cssUri}">
</head>

<body>
    <div id="main">
        <div class="padding"></div>
        <div id="info">
            <table>
                <thead>
                    <tr>
                        <th>Dimensions</th>
                        <th>Spacing</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="dimensions">12</td>
                        <td id="spacing">12</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="padding"></div>
        <div id="label_workspace">
            <div id="label_list">
                <div class="label">
                    1
                    <i class="layui-icon layui-icon-close delete-label"></i>
                </div>           
            </div>
            <div id="add_label">
                <i id="add_label_icon" class="layui-icon layui-icon-addition"></i>
            </div>
        </div>
        <div class="padding"></div>
        <div id="panel">
            <div id="axis">
                <div class="buttons">
                    <button class="layui-btn layui-btn-fluid" id="X">X</button>
                    <button class="layui-btn layui-btn-fluid" id="Y">Y</button>
                    <button class="layui-btn layui-btn-fluid" id="Z">Z</button>
                </div>
                <div class="slider">
                    <i class="layui-inline" id="slice"></i>
                </div>
            </div>
            <div id="data">
                <canvas id="canvas"></canvas>
            </div>
            <div id="window">
                <div class="buttons">
                    <button class="layui-btn layui-btn-fluid" id="A">X</button>
                    <button class="layui-btn layui-btn-fluid" id="B">Y</button>
                    <button class="layui-btn layui-btn-fluid" id="C">Z</button>
                </div>
                <div class="slider">
                    <i class="layui-inline" id="windows"></i>
                </div>
            </div>
        </div>
        <div class="padding"></div>
    </div>
    <script type="text/javascript" src="${scriptUri}"></script>
    <script>
        sliders = {
            slice: null,
            window: null
        }
        function render_slice_slider(min, max, height, value) {
            document.getElementById('slice').innerHTML = '';
            sliders.slice = layui.slider.render({
                elem: "#slice",
                min: min,
                max: max,
                value: value,
                height: height,
                type: 'vertical',
                change: function(value) {
                    sliders.slice.config.value = value;
                    window.postMessage({command: 'slice_change', value: value});
                }
            });
        }
        
        function render_window_slider(min, max, height, min_threshold, max_threshold) {
            document.getElementById('windows').innerHTML = '';
            console.log(height)
            sliders.window = layui.slider.render({
                elem: "#windows",
                min: min,
                max: max,
                range: true,
                height: height,
                type: 'vertical',
                value: [min_threshold, max_threshold],
                change: function(value) {
                    window.postMessage({command: 'window_change', min_threshold: value[0], max_threshold: value[1]});
                }
            });
        }
        
        window.addEventListener('message', function(event) {
            let data = event.data;
            if (data.command === 'render_slice_slider') {
                render_slice_slider(data.min, data.max, data.height, data.value);
            }else if (data.command === 'render_window_slider') {
                render_window_slider(data.min, data.max, data.height, data.min_threshold, data.max_threshold);
            }
        });
        document.getElementById('canvas').addEventListener('wheel', function(event) {
            if (event.deltaY === 0) {
                return;
            }else if (event.deltaY > 0) {
                sliders.slice.setValue(sliders.slice.config.value + 1);
            }else {
                sliders.slice.setValue(sliders.slice.config.value - 1);
            }
        });
        window.postMessage({command: 'ready'});
    </script>
</body>
</html>